--- 
layout: post 
title: 'CentOS, Xen and w2k*' 
author: hrafn 
published: true 
date: 2010-11-12T10:43:59+0000 
permalink: /2010/11/centos-xen-w2k 
tags:
- win2k
- xen
- rhel
- drivers
--- 

Потребовалось поставить w2k8 в качестве гостя на Xen. Для виртуализации
Windows-систем я предпочитаю использовать именно его, поскольку он хоть и
нагружает хост несколько больше, но драйвера паравиртуализации под Xen для
Windows гораздо предпочтительнее из-за более стабильной работы, чем у KVM, да
и саму гостевую систему нагружают гораздо слабее при высокой нагрузке на
винчестер. Под KVM при использовании драйверов паравиртуализации идет сильная
нагрузка на процессор из-за неимоверного количества прерываний.

<!--more-->

До этого с w2k8 мне сталкиваться не приходилось, и за время установки я узнал
много нового :)

Ссылки на драйвера будут указаны в конце, а пока я немного опишу ситуацию с
установкой PV-драйверов.

Итак, установка оных на w2k3 особых проблем не вызывает, если не считать того,
что пришлось применить некоторое шаманство, которое. впрочем. было достаточно
незначительным. Пример, система установлена, загружена и вход в нее
произведен. Скачиваем драйвера и запускаем экзешник. Все бы хорошо, но при
первом запуске установщик может висеть сколько угодно долго без завершения.
Поэтому я выработал такой порядок действий:

  * запускаем установку драйверов
  * ждем некоторое время, пока установщик позадает вопросы на тему согласия использования неподписанных драйверов
  * обрываем процесс установки

Такой первичный запуск позволяет системе понять, что у нее оказывается
появились новые устройства, а вот драйверов под них пока нет :)

Перегружаем w2k3 и запускаем установку заново. Вот теперь системе становится
понятно, что за хрень мы пытаемся ей подсунуть, и все происходит достаточно
быстро и беспроблемно.

Снова перезагрузка. Затем корректировка сетевых настроек, с учетом появления
паравиртуализированной сетевухи, которая является единственный адаптером. И
готово!

Вроде и несколько немморойно, но вполне себе беспроблемно.

С w2k8 r2 все несколько сложнее. Попытавшись поставить драйвера для нее таким
же макаром, я обломался, поскольку, после перезагрузки, предлагается только
восстановление системы и все. Основного раздела Windows не видит и просит
помощи.

Гугление этого вопроса принесло просветление :)

Порядок действий таков.

После установки системы открываем "Командную строку" и пишем:

		C:\Users\Администратор>bcdedit /set testsigning on

Обязательно перегружаемся. После перезагрузки ставим драйвера. запустив
экзешник. Плюсом тут является то, что, в отличие от w2k3, дважды совершать
попытку установки драйверов нет необходимости. Все ставится нормально сразу. В
процессе установки убедитесь, что сертификат также установлен. После
завершения можно перегрузить машину - драйвера стоят :)

Сие шаманство связано с политикой w2k8 по поводу установки драйверов и их
подписи, а также с тем, что PV-драйвера подписаны тестовым сертификатом. Вот
собственно и все.

Полезные ссылки и использованные материалы:

  * [драйвера паравиртуализации для Windows-систем](http://www.meadowcourt.org/downloads/)
  * [выбор нужного драйвера под вашу систему](http://www.jolokianetworks.com/70Knowledge/VirtualizationOpen_Source_Windows_Paravirtualization_Drivers_for_Xen/Choosing_your_GPLPV_Drivers)
  * [статья, которая мне и помогла](http://www.jolokianetworks.com/70Knowledge/Virtualization/Open_Source_Windows_Paravirtualization_Drivers_for_Xen/Installing_the_0.10.x_GPLPV_Drivers)

