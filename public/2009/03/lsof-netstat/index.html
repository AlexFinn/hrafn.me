
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>lsof and netstat - Hrafn.me</title>
  <meta name="author" content="Alexander 'Hrafn' Ivanov">

  
  <meta name="description" content="Очередной перевод очередной заметки с Cool Solutions Поиск открытых файлов и сетевых соединений Одной из многих выгод использования операционной &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hrafn.me/2009/03/lsof-netstat">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/hrafnme" rel="alternate" title="Hrafn.me" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stat.alexfinn.eu/" : "http://stat.alexfinn.eu/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 3);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stat.alexfinn.eu/piwik.php?idsite=3" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft"></div>
  	<div id="logoText"></div>
  	<div id="logoRight"></div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Hrafn.me</a></h1>
  
    <h2>...</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/hrafnme" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hrafn.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/docs">Docs</a></li>
  <li><a href="/lpi">LPI</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Lsof and Netstat</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2009-03-03T00:00:00+03:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Очередной перевод очередной заметки с <a href="http://www.novell.com/coolsolutions/feature/19999.html">Cool Solutions</a></p>

<!--more-->


<h3>Поиск открытых файлов и сетевых соединений</h3>

<p>Одной из многих выгод использования операционной системы Linux является то, что есть возможность получить обширую информацию о процессах, работающих в данный момент, и ресурсах, которые они потребляют. Эта статья описывает две очень полезные команды: lsof и netstat, которые покажут вам список всех открытых файлов или сетевых соединений на системе наряду с соответствующими им процессами.</p>

<p>Их еще одно очевидное преимущество — безопасность. Например, если бы spyware или какая-либо другая malware-программа отправляли бы информацию с вашего компьютера в Интернет или в файл на вашем жестком диске, это можно было увидеть в выводе этих команд.</p>

<h4>lsof — список открытых файлов</h4>

<p>Эта простая команда часто запускается без аргументов и делает только то, что ей сказано: отображать список из каждых открытых файлов каждой программы, запущенной в данной момент.</p>

<p>Обычно вывод lsof выглядит так:</p>

<pre><code>    kain@slickbox:~&gt; lsof
    COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME
    init 1 root cwd unknown /proc/1/cwd
    init 1 root rtd unknown /proc/1/root
    init 1 root txt unknown /proc/1/exe
    init 1 root mem REG 8,22 509596 60081 /sbin/init
    init 1 root mem REG 0,0 0 [heap]
    init 1 root NOFD /proc/1/fd
    kthreadd 2 root cwd unknown /proc/2/cwd
    kthreadd 2 root rtd unknown /proc/2/root
    kthreadd 2 root txt unknown /proc/2/exe
    ...
</code></pre>

<p>Информация в колонках обычно является прямой.</p>

<p>Обычно lsof выводит слишком много информации, чтобы она могла поместиться в буфер прокрутки консоли. Таким образом у вас может возникнуть желание сбросить эту информацию на диск (через <code>lsof &gt; lsof-output.txt</code>) или отфильтровать ее, используя различные pipe-команды.</p>

<p>Например, если хотите увидеть, открыт ли специальный файл /dev/dsp (звуковая карта) каким-нибудь процессом, запустите следующую команду:</p>

<pre><code>    kain@slickbox:~&gt; lsof|grep dsp
    game 3835 kain mem CHR 195,0 13940 /dev/dsp
</code></pre>

<p>Теперь мы можем убить процесс, если хотим освободить звуковую карту:</p>

<pre><code>    kain@slickbox:~&gt; kill -9 3835
    kain@slickbox:~&gt; killall -9 game # это также сработает
</code></pre>

<p>В дополнение к списку открытых файлов lsof может такде оторбражать открытые сокеты (сетевые соединения), если вы запустите его в ключом -i:</p>

<pre><code>    kain@slickbox:~&gt; lsof -i
    COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME
    kded 4140 kain 15u IPv4 15400 TCP localhost:37435 (LISTEN)
    kded 4140 kain 19u IPv6 15483 TCP *:5800 (LISTEN)
    kded 4140 kain 20u IPv6 15488 TCP *:5900 (LISTEN)
    pidgin 4530 kain 14u IPv4 17075 TCP 192.168.1.104:54623-&amp;gt;205.188.9.158:aol (ESTABLISHED)
    pidgin 4530 kain 15u IPv4 17072 TCP 192.168.1.104:56693-&amp;gt;205.188.5.214:aol (ESTABLISHED)
    pidgin 4530 kain 16u IPv4 49002 TCP 192.168.1.104:37275-&amp;gt;64.12.30.80:aol (ESTABLISHED)
    pidgin 4530 kain 17u IPv4 17092 TCP 192.168.1.104:57145-&amp;gt;oam-d09b.blue.aol.com:aol (ESTABLISHED)
    pidgin 4530 kain 18u IPv4 50809 TCP 192.168.1.104:42839-&amp;gt;64.12.30.92:aol (ESTABLISHED)
    pidgin 4530 kain 23u IPv4 17107 TCP 192.168.1.104:43997-&amp;gt;oam-d23c.blue.aol.com:aol (ESTABLISHED)
    firefox-b 9464 kain 10u IPv4 55549 TCP 192.168.1.104:37274-&amp;gt;mu-in-f91.google.com:http (ESTABLISHED)
    firefox-b 9464 kain 44u IPv4 54630 TCP 192.168.1.104:43427-&amp;gt;132.235.194.70:http (ESTABLISHED)
    firefox-b 9464 kain 45u IPv4 54631 TCP 192.168.1.104:43428-&amp;gt;132.235.194.70:http (ESTABLISHED)
    firefox-b 9464 kain 46u IPv4 54635 TCP 192.168.1.104:49242-&amp;gt;132.235.194.69:http
</code></pre>

<p>Можно заметить, что когда я запустил эту команду, у меня уже были запущены pidgin и firefox. В колонке содержится адрес соединения, его номер порта или имя сервиса, и действительно ли сокет LISTEN или ESTABLISHED. Прослушиваемые сокеты соответствуют процессам сервера, запущенным на вашей машине, которые ожидают соединений от других частей. Любые подозрительные слушающие процессы должны быть проверены на предметбезопасности. Если номер порта будет в списке известных сервисов на системе, то он отображается как именованный сервис (например, http или aol в листинге выше). Вы можете поискать файл <code>/etc/services</code>, чтобы узнать, что это такое:</p>

<pre><code>    kain@slickbox:~&gt; cat /etc/services|grep aol
    aol 5190/tcp # America-Online
</code></pre>

<p>Чтобы быть уверенным, что вы получаете полный вывод lsof, вы должны быть пользователем root.</p>

<h4>netstat — инструмент сетевой статистики</h4>

<p>В то время, как <code>lsof -i</code> удобный способ отображения списка сетевых соединений, netstat обеспечивает альтернативный и более подробный способ получаения информации о вашей сети.</p>

<p>Вывод netstat обычно более длинный, чем <code>lsof -i</code>:</p>

<pre><code>    kain@slickbox:~&gt; netstat
    Active Internet connections (w/o servers)
    Proto Recv-Q Send-Q Local Address Foreign Address State
    tcp 0 0 192.168.1.104:56693 205.188.5.214:aol ESTABLISHED
    tcp 0 0 192.168.1.104:55219 64.12.30.80:aol ESTABLISHED
    tcp 0 0 192.168.1.104:43997 oam-d23c.blue.aol.c:aol ESTABLISHED
    tcp 0 0 192.168.1.104:54623 205.188.9.158:aol ESTABLISHED
    tcp 0 0 192.168.1.104:57145 oam-d09b.blue.aol.c:aol ESTABLISHED
    tcp 0 0 192.168.1.104:44775 64.12.30.92:aol ESTABLISHED
    Active UNIX domain sockets (w/o servers)
    Proto RefCnt Flags Type State I-Node Path
    unix 2 [ ] DGRAM 15294 /var/run/NetworkManager/wpa_ctrl_3020-1
    unix 2 [ ] DGRAM 15215 /var/run/wpa_supplicant-global
    unix 3 [ ] DGRAM 15292 /var/run/wpa_supplicant/eth1
    unix 2 [ ] DGRAM 3300 @/org/kernel/udev/udevd
    unix 2 [ ] DGRAM 8419 /var/lib/dhcp/dev/log
    ...
</code></pre>

<p>Заметьте, что netstat указывает также локальный адрес для каждого соединения, а также размер отправленной и полученной очереди, что помогает контролировать активность каждого соединения. В дополнение к этому, она отображает соединения, созданные поверх сокетов Unix, другой механизм для соединений между процессами в Linux.</p>

<p>Вывод netstat можно сделать подобным выводу lsof, добавив <code>-A inet</code> и <code>–program</code>, которые указывают netstat печатать только нелокальные соединения, включая процессы, чьей собственностью они являются:</p>

<pre><code>    slickbox:/home/kain # netstat -A inet --program
    Active Internet connections (w/o servers)
    Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name
    tcp 0 0 192.168.1.104:56693 205.188.5.214:aol ESTABLISHED 4530/pidgin
    tcp 0 0 192.168.1.104:55219 64.12.30.80:aol ESTABLISHED 4530/pidgin
    tcp 0 0 192.168.1.104:43997 oam-d23c.blue.aol.c:aol ESTABLISHED 4530/pidgin
    tcp 0 0 192.168.1.104:54623 205.188.9.158:aol ESTABLISHED 4530/pidgin
    tcp 0 0 192.168.1.104:57145 oam-d09b.blue.aol.c:aol ESTABLISHED 4530/pidgin
    tcp 0 0 192.168.1.104:44775 64.12.30.92:aol ESTABLISHED 4530/pidgin
</code></pre>

<p>Вот и все, что можно сказать по этому поводу. Обе эти команды имеют гораздо больше возможностей, которые вы можете узнать, прочитав соответствующие man-страницы — <code>man lsof</code> и <code>man netstat</code>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alexander 'Hrafn' Ivanov</span></span>

      








  


<time datetime="2009-03-03T00:00:00+03:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2009</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://hrafn.me/2009/03/lsof-netstat" data-via="" data-counturl="http://hrafn.me/2009/03/lsof-netstat" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/2009/03/ispolzovanie-skype-vmeste-s-bluetooth-garnituroj-v-sled-10" title="Previous Post: Использование Skype вместе с Bluetooth-гарнитурой в SLED 10">&laquo; Использование Skype вместе с Bluetooth-гарнитурой в SLED 10</a>
      
      
        <a class="basic-alignment right articlenav" href="/2009/03/pm-utils-opensuse" title="Next Post: pm-utils — openSUSE">pm-utils — openSUSE &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/04/chef-basics-search-and-databags">Основы Chef. Поиск и Data Bags</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/chef-basics-introduction-to-cookbooks">Основы Chef. Введение в "Поваренные книги"</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/chef-basics-core-components">Основы Chef. Базовые компоненты</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/chef-basics-architecture">Основы Chef. Введение в архитектуру</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/about-blog-design">Немного про дизайн</a>
      </li>
    
  </ul>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/103291489173191931572?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Alexander 'Hrafn' Ivanov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
